<!DOCTYPE html>
<html lang="zh">
<head>
    {include file="public/base" /}
    <style>

        pre {
            overflow-y: auto;
            overflow-x: hidden;
        }

        pre code {
            border-radius: 3px;
            white-space: pre;
            padding: 14px !important;
            line-height: 20px;
        }

        /*code ol {
            margin: 0;
        }

        code ol li {
            padding-left: 8px;
        }*/

        pre {
            position: relative
        }

        pre:hover .hljs-button {
            display: block
        }

        blockquote {
            margin: 14px 0;
            padding: 14px;
            font-size: 14px;
            border-left: 5px solid #4CAF50;
            background-color: #F6F6F6;
            color: #999;
        }

        blockquote p {
            line-height: 1.6;
            word-wrap: break-word;
            margin: 0;
        }

        h1 {
            margin: 15px 0;
        }

        .shadow {
            margin-bottom: 8px;
            padding: 16px 24px;
            word-wrap: break-word;
        }

        .hljs-button {
            display: none;
            position: absolute;
            right: 4px;
            top: 4px;
            font-size: 12px;
            color: white;
            padding: 2px 8px;
            margin: 2px;
            cursor: pointer;
        }

        .like-button {
            display: inline-block;
            padding: 5px 10px;
            font-size: 14px;
            border-radius: 5px;
            background: #4CAF50;
            color: white;
            cursor: pointer;
        }

    </style>
</head>
<body>
{include file="public/header" /}
<div class="main">
    <div class="content">
        <div class="shadow">
            <h1 class="article-title">{$post->title}</h1>
            <hr>
            <div style="margin-top: 15px">{$post->contentHtml}</div>
        </div>
        <div class="shadow">
            <p style="margin: 0;color: #8a8a8a">
                posted @ {:timeFormat($post->postTime)} · 阅读({$post->pv}) · 评论({$post->commentCount}) · 点赞(<span
                    id="like">{$post->likeCount}</span>) · 字数({$post->postWordCount}){notempty name="$post->topics"} ·
                分类({:implode('，', $post->topics)}){/notempty}
            </p>
            <p></p>
            <div style="text-align: center">
                <div class="like-button">
                    {if condition="$isLiked"}
                    已点赞
                    {else /}
                    点赞
                    {/if}
                </div>
            </div>
        </div>
    </div>
    {include file="public/sidebar" /}
</div>
{include file="public/footer" /}
{include file="public/base_js" /}
<script>
    //@formatter:off
    {if condition="$isLiked"}
    $(".like-button").css("cursor", 'not-allowed');
    {else /}
        var data = {'postId': {$post->postId}};
        var $likeBtn = $(".like-button");
        $likeBtn.bind('click', function() {
            $.post("/post/like", data,function (data) {
                if (data.code === 200) {
                    let $like = $("#like");
                    var likeCount = $like.text();
                    $like.text(Number(likeCount) + 1);
                    $likeBtn.unbind('click');
                    $likeBtn.text("已点赞");
                    $likeBtn.css("cursor", 'not-allowed');
                } else if (data.code === -1) {
                    $likeBtn.unbind('click');
                    $likeBtn.text("已点赞");
                    $likeBtn.css("cursor", 'not-allowed');
                }
            });
        });
    {/if}
    //@formatter:on

        hljs.initHighlightingOnLoad();

        $("pre").each(function (index, element) {
            let preTag = $(this);
            preTag.append("<div class='hljs-button' title='Copy to Clipboard'>Copy</div>");
            let id = "code" + index;
            preTag.children("code").attr("id", id);
            preTag.children(".hljs-button").attr("data-clipboard-target", "#" + id);
        });
        let clipboard = new ClipboardJS('.hljs-button');
        clipboard.on('success', function (e) {
            e.clearSelection();
            let copyBtn = $(e.trigger);
            copyBtn.html("Copy Success");
            setTimeout(function () {
                copyBtn.html("Copy");
            }, 1000);

        });
        clipboard.on('error', function (e) {
            let copyBtn = $(e.trigger);
            copyBtn.html("Copy Fail");
            setTimeout(function () {
                copyBtn.html("Copy");
            }, 1000);
        });
</script>
</body>
</html>